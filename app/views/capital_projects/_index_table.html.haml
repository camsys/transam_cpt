%table.table.table-hover#datatable
  %thead
    %tr
      %th.left Agency
      %th.left FY
      %th.left Project
      %th.center Scope

      %th.center Type
      %th.left Title
      %th.center Status
      %th.right Cost

      %th.right State
      %th.right Federal
      %th.right Local
      %th.right Total

      %th.center

  %tbody
    - total_cost = 0
    - total_state = 0
    - total_federal = 0
    - total_local = 0
    - total_total = 0

    - @projects.each do |p|
      - total_cost += p.total_cost
      - total_state += p.state_request
      - total_federal += p.federal_request
      - total_local += p.local_request
      - total_total += p.total_request

      %tr.popup-details{:data => {:action_path => capital_project_path(p)}}
        %td= p.organization
        %td= p.fiscal_year
        %td= p.project_number
        %td.center= p.team_ali_code.scope
        %td.center= p.capital_project_type.code

        %td= p.title
        %td.center= p.capital_project_status_type

        %td.right= format_as_currency(p.total_cost)

        %td.right= format_as_currency(p.state_request)
        %td.right= format_as_currency(p.federal_request)
        %td.right= format_as_currency(p.local_request)
        %td.right= format_as_currency(p.total_request)

        %td.center
          %i.fa.fa-info-circle.text-info.popup-details{:data => {:title => "#{p.project_number}: Activity Line Items", :content => "#{raw render :partial => 'capital_projects/activity_line_items_table', :locals => {:project => p, :popup => false}}"}}
          = link_to shift_fiscal_year_capital_project_path(p, :num_years => -1, :view => 1), :title => 'Schedule earlier' do
            %i.fa.fa-arrow-left.fa-fw
          = link_to shift_fiscal_year_capital_project_path(p, :num_years => +1, :view => 1), :title => 'Schedule later' do
            %i.fa.fa-arrow-right.fa-fw

  %tfoot
    %tr
      %td{:colspan => 7}
        %td.right= format_as_currency(total_cost)
        %td.right= format_as_currency(total_state)
        %td.right= format_as_currency(total_federal)
        %td.right= format_as_currency(total_local)
        %td.right= format_as_currency(total_total)

= render 'shared/datatable_javascript'

:javascript
  $('.popup-details').popover({
    trigger: 'hover',
    container: 'body',
    placement: 'left',
    animation: 'true',
    html: 'true'
  });

= simple_form_for(@builder_proxy,
  :html => {:class => 'form-vertical'},
  :url => runner_capital_projects_path,
  :wrapper => :vertical_form,
  :wrapper_mappings => {:check_boxes => :vertical_radio_and_checkboxes,
  :radio_buttons => :vertical_radio_and_checkboxes,
  :file => :vertical_file_input,
  :boolean => :vertical_boolean}) do |f|

  - if @organization_list.count > 1
    .row
      .col-md-12
        = f.input :organization_id, :required => true, :collection => Organization.where(id: @organization_list)
  .row
    .col-md-6
      = f.input :asset_types, :required => true,   :collection => @asset_types.map{|type| [type[:name], type[:id]]}, :multiple => true, :as => :check_boxes
    .col-md-6
      = f.input :start_fy, :required => true,      :collection => @fiscal_years, :include_blank => false, :label => "Starting Fiscal Year"

  - if @organization.has_sogr_projects?
    .row
      .col-md-12
        = render 'builder_warning'

  = f.submit "Run analyzer...", :class => "btn btn-primary", :id => "submit_button"


:javascript
  var org_id = 0;
  var asset_types = JSON.parse('#{@asset_types.to_json}');

  //console.log(asset_types);

  // Detect changes in the org selected
  $('#builder_proxy_organization_id').on('change', function(event) {
    var id = $(this).val();

    if (id != org_id) {
      // store the selected org
      org_id = id;

      // Reset
      $('#builder_proxy_asset_type_id').val('');
      $('#builder_proxy_start_fy').val('');

      // Set asset types of org only
      for (var j = 0; j < asset_types.length; j++){
        type = asset_types[j]

        if ($.inArray( parseInt(id), type.orgs ) >= 0) {
          $('#builder_proxy_asset_types_'+type.id).parent().parent().show();
        } else {
          $('#builder_proxy_asset_types_'+type.id).parent().parent().hide(); // hide whole span
        }
      }

      // TODO set start fy
      // TODO show/hide builder form
    }
  });

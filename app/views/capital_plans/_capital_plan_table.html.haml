:ruby
  show_actions ||= 0
  table_dom_id ||= SecureRandom.hex




.table-responsive
  %table.table.table-condensed.table-hover{:id => table_dom_id, :data => {:toggle => 'table',
    :card_view => "false",
    :pagination => 'false',
    :search => 'false',
    :show_columns => 'true',
    :show_export => 'true',
    :row_style => 'row_style',
    :click_to_select => 'true',
    :export_types => "['csv', 'txt', 'excel']",
    :id_field => 'object_key',
    :state_save => 'true',
    :state_save_id_table => "capital_plans_id",
    :state_save_expire => "1y",
    :single_select => 'true'}}

    %thead
      %tr
        %th
        %th
        %th
        %th
        %th.bs-checkbox{:data => {:checkbox => 'true', :field => 'state', :formatter => 'checkBoxFormatter'}}

    %tbody
      - prev_action = @capital_plan.capital_plan_actions.last
      - @capital_plan.capital_plan_actions.each do |a|
        %tr
          - if a.capital_plan_action_type.capital_plan_module_type != prev_action.capital_plan_action_type.capital_plan_module_type
            %td.left= a.capital_plan_action_type.capital_plan_module_type
          - else
            %td
          - prev_action = a
          %td.left= a.object_key
          %td.left= a.capital_plan_action_type
          %td.left= a.notes
          %td
            - if a.system_action?
              = "system-#{a.notes}"
            - else
              - checkbox_params = ''
              - if a.completed?
                - checkbox_params = 'checked'
              - if !(a.is_allowed? && (can? :complete_action, a))
                - checkbox_params += ' disabled'

:javascript
  var hide_checkboxes = [];

  function checkBoxFormatter(value, row, index) {
    var params = {};

    if (value.indexOf('system') != -1) {
      hide_checkboxes.push(index);
      return value.substring(8);
    } else {
      if (value.indexOf('checked') != -1) {
        params['checked'] = true;
      }
      if (value.indexOf('disabled') != -1) {
        params['disabled'] = true;
      }
      return params;
    }

  }

  $(document).ready(function() {

    $.each(hide_checkboxes, function( index, value ) {
      $('input[data-index="'+value+'"]').hide();
    });
  });


:ruby
  fy_year = @project.fy_year
  org = Organization.get_typed_organization(@project.organization)
  budgets = org.available_budgets(fy_year)
  federal_budget_remainder = budgets[0]
  state_budget_remainder = budgets[1]

.row
  .col-md-12{:style => 'height:160px;overflow-y:auto;'}
    = render :partial => 'funding_requests_table', :locals => {:ali => @activity_line_item, :popup => true}

.row
  .col-md-12
    %fieldset
      %legend Add Funding Request
      .col-md-12
        = render 'funding_messages'

      - if @activity_line_item.anticipated_cost > 0 and @activity_line_item.funding_difference > 0
        - if federal_budget_remainder > 0 or state_budget_remainder > 0
          .col-md-12
            = simple_form_for([@project, @activity_line_item, FundingRequest.new],
                :wrapper => :horizontal_form,
                :wrapper_mappings => {:check_boxes => :horizontal_radio_and_checkboxes, :radio_buttons => :horizontal_radio_and_checkboxes, :file => :horizontal_file_input, :boolean => :horizontal_boolean}) do |f|
              .row
                .col-xs-6
                  = f.input :federal_funding_line_item_id, :collection => @available_funds, :label => 'Federal Fund', :label_method => 'details', :required => true
                .col-xs-3
                  = f.input :amount, :wrapper=> :horizontal_prepend, :label => false do
                    %span.input-group-addon
                      %i.fa.fa-usd
                    = f.input_field :federal_amount, :class => "form-control", :number => true, :min => 0, :max => 10000000

              .row
                .col-xs-6
                  = f.input :state_funding_line_item_id, :collection => @available_funds, :label => 'State Fund', :label_method => 'details', :required => true
                .col-xs-3
                  = f.input :amount, :wrapper=> :horizontal_prepend, :label => false do
                    %span.input-group-addon
                      %i.fa.fa-usd
                    = f.input_field :state_amount, :class => "form-control", :number => true, :min => 0, :max => 10000000

              .row
                .col-xs-6
                  = f.input :amount, :wrapper=> :horizontal_prepend, :label => "Local match" do
                    %span.input-group-addon
                      %i.fa.fa-usd
                    = f.input_field :local_amount, :class => "form-control", :number => true, :min => 0
              .row
                .col-xs-6
                  .col-xs-offset-3.col-xs-3
                    = f.submit "Add", :class => 'btn btn-primary'

:css
  .with-margin {
    margin-bottom: 5px;
  }
  .comments_panel {
    background: var(--gray-medium-light);
    margin-right: -5px;
    margin-left: 5px;
    border-bottom: 1px solid var(--gray-medium);
  }

  .list-group {
    display: flex;
    flex-direction: column-reverse;
  }

  .comment {
    margin: 5px 10px;
    display:flex;
    flex-direction: column-reverse;
  }

  .comment > span:not(.title) {
    min-width: 0px;
    display: inline-flex;
    align-self: flex-end;
    margin-bottom: -32px;
  }

  .comment_form {
    padding: 0px 10px !important;
  }

  .comment_form .form-group .form-control {
    background: #fff;
  }

  .comment_form #comment_submit {
    float: right;
    margin-bottom: 10px;
  }

  .comment_form #comment_comment {
    resize: vertical;
  }



  .table_header {
    margin-top: 0px;
  }

  .project_phase_panel {
    margin: 0px 10px 0px 24px;
  }

  .phase_filter {
    padding: 0px 30px 24px !important;
  }

  .divider {
    height: 1px;
    margin: 5px 1px;
    overflow: hidden;
    background-color: #E5E5E5;
    border-bottom: 1px solid #FFF;
  }

  .chart_row {
    padding-top: 64px;
  }




//TITLE
.row.text-center
  %h1
    =@scenario.name 
  .row
    =@scenario.description
  .row
    =link_to edit_scenario_path(@scenario) do 
      %i.fa.fa-edit

//Main Content  
.row
  .col-md-1
  
  //Details
  .col-md-3
    .row
      %strong 
        Organization: 
      =@scenario.organization
    .row
      %strong
        Cost:
      =format_as_currency(@scenario.cost)

  .col-md-4
    .progress
      .progress-bar.bg-success{role: "progressbar", style: "width: #{@scenario.percent_funded}%"}
        ="#{@scenario.percent_funded}% Funded"


  //State Info and Actions
  .col-md-2
  .col-md-2
    .well
      .row
        %h4
          =@scenario.state.titleize
        =@scenario.state_description
      .row.text-center
        %br
        =render "#{@scenario.state}_actions"


.row 
  .col-md-12
    =column_chart @scenario.year_to_cost_ali_breakdown, prefix: "$", stacked: true

.row
  .col-md-12
    =render partial: 'scenario_assets_table', locals: {transit_assets: @transit_assets}

.row
  /// LEFT COLUMN
  .col-md-4
    //Comments
    .row
      =render 'scenario_comments'
    
    //Assets


    

  // RIGHT COLUMN

  //Phases
  .col-md-8
    = form_with model: @scenario, html:{class: "phase_filter"} do |f|
      = f.select :ali_select, @scenario.draft_projects.map { |proj| proj.team_ali_code }, include_blank: "Select ALI"
      = f.select :year_select, @scenario.draft_project_phases.map { |ph| ph.fy_year }.uniq.sort.map!{ |y| format_as_fiscal_year(y) }, include_blank: "Select Year"
    -@scenario.draft_project_phases.each_with_index do |phase, index|
      .row.project_phase_panel
        .col-md-12
          =render partial: "phase_with_assets_panel", locals: {phase: phase}
//Projects
.row
  .col-md-12
    =render partial: "draft_projects_table", locals: {scenario: @scenario}

:javascript

  let phase_filter = (code, year)=>{
    console.log(code, year);
    $(".phase").show();
    if(code) {
      $(".phase:not([ali='" + code + "'])").hide();
    }
    if(year) {
      $(".phase:not([year='" + year + "'])").hide();
    }
  };

  $(document).on("change", "select[name='scenario[ali_select]']", (x) => {
    phase_filter($(x.target).val(), $(x.target).siblings("select").val());
  });

  $(document).on("change", "select[name='scenario[year_select]']", (x) => {
    phase_filter($(x.target).siblings("select").val(), $(x.target).val());
  });



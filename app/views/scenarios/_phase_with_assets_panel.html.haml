:css
  .panel_asset_table {
    padding:10px;
  }

  .phase_info {
    padding: 10px 15px;
  }

  .panel-body {
    padding: 0px 0px 0px 10px;
  }
.panel.panel-default.phase{ ali: "#{phase.draft_project.team_ali_code}", year: "#{format_as_fiscal_year(phase.fy_year)}"}
  .panel-heading
    =link_to draft_project_path(phase.draft_project) do
      =phase.draft_project.try(:title).try(:titleize)
    = ">"
    =link_to draft_project_phase_path(phase) do
      =phase.name
      =" (#{phase.get_fiscal_year})"
  .panel-body 
    -assets = phase.transit_assets
    -backlog = assets.select{ |a| a.in_backlog }
    -ages = (assets.map{ |a| a.age }).compact #Compact removes nil ages
    -conditions = (assets.map{ |a| a.reported_condition_rating }).compact #Compact removes nil conditions
    .row 
      .col-md-2.phase_info
        .row
          %strong 
            ALI:
          =phase.team_ali_code.try(:code)
        .row 
          %strong
            Shadow:
          =phase.notional.to_s
        .row
          %strong
            Cost:
          =format_as_currency(phase.cost)
        .row
          %strong
            Allocated:
          =format_as_currency(phase.allocated)
        .row
          %strong
            Remaining:
          =format_as_currency(phase.remaining)
        .row
          %strong
            ="Asset Count: "
          =assets.count
        .row
          %li.divider
        .row
          %strong
            ="Backlog:"
          -avg = ((backlog.size.to_f/assets.size.to_f)*100).round(2)
          =avg 
          ="%"
        .row.text-center
          -# %strong
          -#   ="Backlog%"
          =pie_chart [["Backlog",avg],["Not Backlog",100.0-avg]] , legend: "bottom", donut: true, colors:["red","blue"], suffix:'%'
      .col-md-10.panel_asset_table
        .row.text-left
          .col-md-2 
            .row
              %strong
                ="Age"
            .row
              ="Min"
              -# =assets.map{ |a| a.history.last.try(:event_date) }.min
              =ages.min
            .row
              ="Max"
              -# =assets.map{ |a| a.life_cycle_action_date }.max
              =ages.max
            .row 
              ="Avg"
              -if ages.empty?
                N/A
              -else
                =(ages.reduce(:+) / ages.size.to_f).round(2)
          .col-md-2
            .row.text-left
              %strong
                ="Condition"
            .row
              ="Min"
              =conditions.min
            .row
              ="Max"
              =conditions.max
            .row
              ="Avg"
              -if conditions.empty?
                N/A
              -else
                =(conditions.reduce(:+) / conditions.size.to_f).round(2)
          -if assets.first.try(:very_specific).respond_to?(:reported_mileage)
            .col-md-2
              .row.text-left
                %strong
                  ="Mileage"
                -milages = assets.map{ |a| a.very_specific.reported_mileage || 0 }
              .row
                ="Min"
                =milages.min.to_s(:delimited)
              .row
                ="Max"
                =milages.max.to_s(:delimited)
              .row
                ="Avg"
                =(milages.reduce(:+) / milages.size.to_f).round(2).to_s(:delimited)
        .row.chart_row
          .col-md-6 
            .row.text-center
              =scatter_chart phase.age_to_condition, xtitle: "Age(Years)", ytitle:"Condition(1-5)", legend: false, discrete: true, colors:["blue"]
              
          .col-md-6 
            .row.text-center 
              =scatter_chart phase.age_to_mileage, xtitle: "Age(Years)", ytitle:"Mileage", thousands: ",", legend: false, colors:["blue"]

        -# =render partial: "phase_with_assets_panel_table", locals: {draft_project_phase: phase}
      
  .panel-footer.text-right
    ="Created: #{phase.created_at.strftime('%m/%d/%Y at %I:%M%p')}"